#!/usr/bin/env python
# coding: utf-8

import pandas as pd
import numpy as np

# Listas de items: Cada lista contiene los códigos del catálogo de bienes y servicios del GCBA asociados a los ítems relevantes para la investigación

lista_ventilador=['33.01.002.0300.5','33.01.002.0300.9','33.01.002.0300.2','33.01.002.0300.1','33.01.002.0300.10', '33.01.002.0300.6','33.01.002.0300.13','33.01.002.0300.4','33.01.002.0300.3', '33.01.002.0300.12','33.01.002.0300.11','33.01.002.0300.8','33.01.002.0300.7','33.14.001.0002.15', '33.01.003.0056.4','33.01.003.0056.1','33.01.003.0056.3','33.01.003.0056.12','33.01.003.0056.15', '33.01.003.0056.13','33.01.003.0056.7','33.01.003.0056.2','33.01.003.0056.14','33.01.003.0056.8', '33.14.001.0002.84','33.01.003.0056.9','32.01.195.0007.1','33.14.001.0002.28']

lista_limpieza=['18.11.002.0001.3','18.11.002.001.4','18.11.2.1.1','18.11.002.0001.5','18.11.002.0002.1','18.11.002.0005.1', '18.11.002.001.4','18.11.2.1.1','18.9.2.3.1','18.11.002.0003.1' ]

lista_camas=['33.09.003.0039.1', '33.09.003.000.74', '33.9.3.2.1', '33.09.003.0002.3', '33.09.003.000.233', '33.09.003.0002.2', '33.09.003.0002.1','33.09.003.000.37','33.9.3.2.2','33.09.003.0003.1', '33.09.003.0003.2','19.01.004.0010.1', '19.01.004.0010.2','33.09.003.0039.2','33.09.003.000.89', '33.09.003.000.88','33.09.003.0039.3']

lista_desfibrilador=['33.01.003.0048.1','33.14.001.0002.9','33.01.003.0048.3','33.1.3.48.3','32.01.195.0010.1','33.18.004.0003.1', '33.01.003.0048.2','33.01.003.0048.4']

lista_carro_paro=['33.09.003.0006.1', '33.9.3.6.1']

oximetro=['33.01.003.0055.1','33.01.003.0055.2']

cofias=['33.15.004.0019.1','33.15.004.0019.2','22.01.001.0030.1', '33.15.004.000.276','33.15.004.000.50','33.15.004.0019.1', '33.15.004.0019.2']

botas=['33.15.004.0014.1','33.15.004.0014.2', '33.15.004.0014.3', '33.15.004.0014.4', '33.15.004.0014.5', '33.15.004.0014.6','33.15.004.000.26','33.15.004.000.26','33.15.004.000.52','33.15.004.000.54','33.15.004.000.55','33.15.004.000.57', '33.15.004.0014.1','33.15.004.0015.1']

alcohol_etilico=['06.15.001.0005.1','13.01.003.0066.1','13.01.003.0066.3','13.01.003.066.1','33.01.002.0131.1', '33.01.002.0258.5','33.01.002.0367.11','33.07.003.0001.4','33.07.003.0001.5','33.07.003.000.3930','33.07.003.000.3941', '33.07.003.000.767','33.07.003.0001.2','33.07.003.0001.4','33.07.003.0001.5','33.07.003.0001.6','33.07.003.0001.7', '33.07.003.0928.10','33.10.002.000.3802','33.10.002.000.3893','33.10.002.0005.1','33.10.002.0005.9','33.10.002.0018.1', '33.10.002.0355.125','33.10.002.0393.1','33.10.2.18.1','33.10.2.5.1','33.7.3.1.1','6.15.1.5.1', '33.07.003.0001.5', '33.07.003.0001.6', '33.07.003.0001.4', '33.01.002.0367.11', '33.01.002.0131.1', '06.15.001.0005.1', '33.01.002.0258.5', '33.10.002.0018.1', '13.01.003.0066.1', '13.01.003.0066.3', '33.07.003.0001.2', '33.07.003.0001.7', '33.01.002.0367.12', '06.15.001.0211.1', '06.15.001.0213.1', '06.15.001.0128.1', '33.10.002.0355.125', '33.10.002.0005.1', '33.10.002.0005.2', '33.10.002.0005.3', '33.10.002.0005.4', '33.10.002.0005.5', '33.10.002.0005.6', '33.10.002.0005.9', '33.07.003.0928.10', '33.10.002.0393.1']

mascara_facial=['33.01.002.0070.2','21.02.001.0033.17','21.02.001.0033.37','21.02.001.0033.42', '21.02.001.0033.1', '21.02.001.0033.3', '21.02.001.0033.5', '21.02.001.0033.7', '21.02.001.0033.9', '21.02.001.0033.11', '21.02.001.0033.13', '21.02.001.0033.15', '21.02.001.0033.17', '21.02.001.0033.19', '21.02.001.0033.21', '21.02.001.0033.23', '21.02.001.0033.25', '21.02.001.0033.27', '21.02.001.0033.29', '21.02.001.0033.31', '21.02.001.0033.33', '21.02.001.0033.35', '21.02.001.0033.37', '21.02.001.0033.39', '21.02.001.0033.41', '21.02.001.0033.43', '21.02.001.0033.45', '21.02.001.0033.47', '21.02.001.0033.49', '21.02.001.0033.51', '21.02.001.0033.53', '21.02.001.0033.55', '21.02.001.0033.57', '21.02.001.0033.59', '21.02.001.0033.61', '21.02.001.0033.63', '21.02.001.0033.65', '21.02.001.0033.67', '21.02.001.0033.69', '21.02.001.0033.71', '21.02.001.0020.1', '21.02.001.0020.3', '21.02.001.0020.5', '21.02.001.0020.7', '21.02.001.0033.10', '21.02.001.0033.12']

mameluco=['22.01.001.000.294', '22.01.001.0030.1', '22.01.001.0042.2', '22.01.001.0043.1', '22.01.001.0043.2', '22.01.001.0043.3', '22.01.001.0030.1', '33.15.004.0021.1', '22.01.001.0042.1', '22.01.001.0043.2', '22.01.001.0043.3']

antiparras=['21.02.001.0007.4','21.02.001.000.1','21.02.001.0007.3','33.15.004.0012.1','33.15.004.0012.1','33.15.004.0012.2']

bolsa_obito=['25.01.003.0001.1', '25.01.003.0001.2', '25.01.003.0001.3', '25.01.003.0001.4', '25.01.003.0001.5', '25.01.003.0001.6', '25.01.003.0001.7', '25.01.003.0001.8', '25.01.003.0001.9', '25.01.003.0001.10', '25.01.003.0001.11', '25.01.003.0001.12', '25.01.003.0001.13', '25.01.003.0001.14']

hisopos=['33.02.002.000.845','33.02.002.0025.4','33.02.002.0025.5','33.02.002.0025.7','33.02.002.0025.8','33.02.002.0080.33', '33.02.002.0096.1','33.07.003.0601.2','33.07.003.0601.3','33.07.003.0601.4','33.07.003.0601.5','33.2.2.25.4', '33.7.3.601.2','33.7.3.601.5','33.07.003.0601.3','33.07.003.0601.4','33.07.003.0601.5','33.7.3.601.2','33.7.3.601.5', '33.08.002.0013.3', '33.08.002.0013.4', '33.02.002.0025.4', '33.02.002.0025.5', '33.02.002.0025.7', '33.02.002.0025.8', '33.07.003.0601.2', '33.07.003.0601.3', '33.07.003.0601.4', '33.07.003.0601.5']

alcohol_gel=['18.06.013.0001.1','18.6.13.1.1','32.01.195.0048.12','33.01.002.000.5697','33.08.001.0001.2','33.10.002.0005.2','33.10.002.0005.3', '33.10.002.0005.4','33.10.002.0005.7','33.10.002.0005.8','18.06.013.0001.1','18.06.013.0001.2','32.01.195.0048.12','33.01.002.0620.1']

guantes_examinacion=['32.01.195.0048.16','33.01.002.0067.1','33.01.002.0067.10','33.01.002.0067.11','33.01.002.0067.12','33.01.002.0067.14', '33.01.002.0067.15','33.01.002.0067.16','33.01.002.0067.17','33.01.002.0067.18','33.01.002.0067.19','33.01.002.0067.2', '33.01.002.0067.20','33.01.002.0067.27','33.01.002.0067.3','33.01.002.0067.4','33.01.002.0067.5','33.01.002.0067.7','33.01.002.0067.8', '33.01.002.0067.9', '33.01.002.0067.1', '33.01.002.0067.2', '33.01.002.0067.3', '33.01.002.0067.4', '33.01.002.0067.5', '33.01.002.0067.6', '33.01.002.0067.7', '33.01.002.0067.8', '33.01.002.0067.9', '33.01.002.0067.10', '33.01.002.0067.11', '33.01.002.0067.12', '33.01.002.0067.13', '33.01.002.0067.14', '33.01.002.0067.15', '33.01.002.0067.16', '33.01.002.0067.17', '33.01.002.0067.18', '33.01.002.0067.19', '33.01.002.0067.20', '32.01.195.0048.16', '33.01.002.0067.27']

camisolines=['33.15.004.000.11','33.15.004.000.24','33.15.004.000.267','33.15.004.000.275','33.15.004.000.276','33.15.004.000.278', '33.15.004.000.282','33.15.004.000.288','33.15.004.000.289','33.15.004.000.290','33.15.004.000.292','33.15.004.000.293', '33.15.004.000.294','33.15.004.000.39','33.15.004.000.59','33.15.004.000.7','33.15.004.0000.267','33.15.004.0001.1', '33.15.004.0001.2','33.15.004.0001.4','33.15.004.0001.5','33.15.004.0001.6','33.15.004.0004.1','33.15.004.0004.2', '33.15.004.0004.3','33.15.004.0007.13','33.15.004.0007.14','33.15.004.0007.15','33.15.004.0007.16','33.15.004.0007.17', '33.15.004.0007.18','33.15.004.0007.2','33.15.004.0007.21','33.15.004.0007.24','33.15.004.0007.25','33.15.004.0007.26','33.15.004.0007.27', '33.15.004.0007.3','33.15.004.0007.5','33.15.004.0007.6','33.15.004.0007.7','33.15.004.0018.3','33.15.004.0018.4','33.15.4.1.1', '33.15.4.7.2','33.15.4.7.7','33.15.4.7.8', '33.15.004.0001.1', '33.15.004.0001.2', '33.15.004.0004.1', '33.15.004.0004.2', '33.15.004.0001.3', '33.15.004.0004.3', '33.15.004.0018.2', '33.15.004.0001.4', '33.15.004.0001.5', '33.15.004.0001.6', '33.15.004.0018.3', '33.15.004.0001.7', '33.15.004.0018.4', '33.15.004.0018.5', '33.15.004.0001.8']

n95=['21.02.001.0004.2','21.2.1.4.1','21.02.001.0004.1' ,'22.01.001.0030.1','33.15.004.0002.1','21.02.001.0004.1','21.02.001.0004.2']

tricapa=['33.15.004.000.276','33.15.004.0002.2','33.15.004.0002.3', '33.15.004.0002.5','33.15.004.0002.7','33.15.4.2.1','33.15.004.0002.1', '33.15.004.0002.2','33.15.004.0002.3', '33.15.004.0002.4','33.15.004.0002.5','33.15.004.0002.6','33.15.004.0002.7','32.01.195.0081.3','22.01.001.0086.1']

termometro=['28.02.019.0001.154','28.02.019.0001.156','28.02.019.0001.158','28.02.019.0001.159','28.02.019.0001.167', '28.02.019.0001.171','33.01.002.0077.2','33.01.002.0077.3','33.1.2.77.2','33.1.2.77.3','33.1.2.77.4','28.02.019.0001.171']

ecmo=['33.01.002.0345.1','33.01.002.0079.1','33.01.002.0079.10','33.01.002.0079.11','33.01.002.0079.2','33.01.002.0079.5', '33.01.002.0079.7','33.01.002.0079.9','33.1.2.79.1','33.1.2.79.10','33.1.2.79.11','33.1.2.79.2','33.1.2.79.5','33.1.2.79.7', '33.01.002.0079.1', '33.01.002.0079.2', '33.01.002.0079.3', '33.01.002.0079.4', '33.01.002.0079.5', '33.01.002.0079.6', '33.01.002.0079.7', '33.01.002.0079.8', '33.01.002.0079.9', '33.01.002.0079.10', '33.01.002.0079.11', '33.01.002.0345.1']

tubo_oxigeno=['30.09.006.0002.3', '30.09.006.0002.3','30.09.006.0002.4','30.09.006.0002.6','30.09.006.0002.7','30.09.006.0002.8', '33.01.003.0125.2','33.14.001.0001.1','33.14.001.0002.5','30.2.10.1.1','33.14.001.0002.5', '06.15.005.0021.1', '06.15.005.0015.1', '33.14.001.0001.1', '33.14.001.0001.1', '06.15.003.0003.3', '30.09.006.0002.1', '30.09.006.0002.2', '30.09.006.0002.3', '30.09.006.0002.4', '30.09.006.0002.5', '30.09.006.0002.6', '30.09.006.0002.7', '30.09.006.0002.8', '30.09.006.0002.9', '30.09.006.0002.10', '30.09.006.0002.11', '30.09.006.0002.12', '33.01.003.0046.1', '33.01.003.0046.2', '26.04.002.0002.68', '32.01.195.0057.1', '33.10.002.0449.1', '33.10.002.0449.2' ]

tensiometro=['32.01.195.0063.3','33.01.003.0002.1','33.01.003.0002.2','33.01.003.0002.3','33.01.003.0002.4','33.01.003.0002.5','33.01.003.0002.6','33.1.3.2.1', '33.1.3.2.2','33.1.3.2.3']

aspirador_manual=['33.01.002.000.5899','33.01.002.0553.1', '32.01.195.0052.1']

resucitador_manual=['33.01.002.0314.22','33.01.002.0090.2','33.01.002.0090.1','33.01.002.0117.4', '33.01.002.0117.3','33.01.002.0117.2','33.01.002.000.5620','33.01.002.000.5355']

ecografo=['33.14.001.0002.38','33.01.003.0058.3','33.01.003.0058.1','33.1.3.58.1','33.01.003.0058.7','33.01.003.0058.5', '33.01.003.0058.2','33.1.3.58.2','33.04.002.000.286','33.01.003.0058.6']

humidificadores=['33.02.002.000.599','33.01.002.0113.16','33.01.003.0114.2','33.02.002.0145.1','33.02.002.000.589']

monitor_multiparametrico=['33.01.003.0049.1','33.01.003.0050.2','33.01.003.0106.1','33.01.003.0050.5','33.01.003.0050.3','33.01.003.0050.6', '33.01.003.0050.7','33.01.003.0050.1','33.14.001.0002.45','33.14.001.0002.44','33.01.003.0050.4','33.01.003.0049.2','33.14.001.0002.22', '33.14.001.0002.23']

# Diccionario vacío
resultados={'item':[],'prov_historicos':[],'prov_posemergencia':[],'%posemergencia':[]}

# Lista que contiene las distintas listas de códigos del catálogo
lista_items=[lista_ventilador,lista_limpieza,lista_camas,lista_desfibrilador,lista_carro_paro,oximetro,cofias,botas,
             alcohol_etilico,mascara_facial,mameluco,antiparras,bolsa_obito,hisopos,alcohol_gel,guantes_examinacion,
             camisolines,n95,tricapa,termometro,ecmo,tubo_oxigeno,tensiometro,aspirador_manual,resucitador_manual,ecografo,
             humidificadores,monitor_multiparametrico]

nombre_items=['lista_ventilador','lista_limpieza','lista_camas','lista_desfibrilador','lista_carro_paro','oximetro','cofias','botas',
             'alcohol_etilico','mascara_facial','mameluco','antiparras','bolsa_obito','hisopos','alcohol_gel','guantes_examinacion',
             'camisolines','n95','tricapa','termometro','ecmo','tubo_oxigeno','tensiometro','aspirador_manual','resucitador_manual','ecografo',
             'humidificadores','monitor_multiparametrico']

# Función: Nuevo campo indicando cuales son los ítems relevantes y otro indicando si "anio_inicio_contrato" es 2020 o 2019

def proveedor_item(item, lista_codigos):
    
    contracs_items_provider_acotado=contracs_items_provider_limpio.copy()
    
    contracs_items_provider_acotado=contracs_items_provider_acotado[['ocid','contracts/0/signatories/0/name',
                                                                     'contracts/0/signatories/0/id','contracts/0/items/0/classification/id',
                                                                     'anio_inicio_contrato','2019', '2020', 'pre_emergencia','pos_emergencia']]
    contracs_items_provider_acotado[item]=pd.Series()
    
    contracs_items_provider_acotado[item][contracs_items_provider_acotado['contracts/0/items/0/classification/id'].isin(lista_codigos)]=1
    
    contracs_items_provider_acotado=contracs_items_provider_acotado[contracs_items_provider_acotado[item]==1]
    
    contracs_items_provider_acotado=contracs_items_provider_acotado[(contracs_items_provider_acotado['anio_inicio_contrato']=='2019.0')|
                                                                    (contracs_items_provider_acotado['anio_inicio_contrato']=='2020.0')]

    contracs_items_provider_acotado=contracs_items_provider_acotado[['ocid','contracts/0/signatories/0/name',
       'contracts/0/signatories/0/id','anio_inicio_contrato','2019', '2020', 'pre_emergencia','pos_emergencia']]
    
    contracs_items_provider_acotado=contracs_items_provider_acotado.drop_duplicates().reset_index(drop=True)
    
    contracs_items_provider_acotado=contracs_items_provider_acotado.groupby('contracts/0/signatories/0/name').sum().reset_index()
    
    return contracs_items_provider_acotado

# Cargar csv contracs_item_provider_limpio
path=''
contracs_item_provider_limpio=pd.read_csv(path)

# Completar dic "resultados": Item, numero de proveedores pre emergencia, numero de proveedores en emergencia

for i,j in zip(nombre_items,lista_items):
    resultados['item'].append(i)
    
    resultados['prov_historicos'].append(len(proveedor_item(i, j)[proveedor_item(i, j)['pre_emergencia']!=0]))
    
    resultados['prov_posemergencia'].append(len(proveedor_item(i, j)[proveedor_item(i, j)['pos_emergencia']!=0]))
    
    try:
        resultados['%posemergencia'].append((len(proveedor_item(i, j)[proveedor_item(i, j)['pos_emergencia']!=0])/len(proveedor_item(i, j)))*100)
    
    except:
        resultados['%posemergencia'].append(np.nan)
        
items_proveedores_1920=pd.DataFrame.from_dict(resultados)

# Serializar datos
output_path=''

items_proveedores_1920.to_excel(output_path, index=False, sep=',', encoding='utf-8')

